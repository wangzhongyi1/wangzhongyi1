<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>javascript 性能优化 | 目录</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="基于vuepress的博客文档">
    
    <link rel="preload" href="/wangzhongyi1/assets/css/0.styles.beeb4ccc.css" as="style"><link rel="preload" href="/wangzhongyi1/assets/js/app.ef63c046.js" as="script"><link rel="preload" href="/wangzhongyi1/assets/js/2.c8cb3ded.js" as="script"><link rel="preload" href="/wangzhongyi1/assets/js/15.ffaedc48.js" as="script"><link rel="prefetch" href="/wangzhongyi1/assets/js/10.571b8207.js"><link rel="prefetch" href="/wangzhongyi1/assets/js/11.73954e40.js"><link rel="prefetch" href="/wangzhongyi1/assets/js/12.fb7585dc.js"><link rel="prefetch" href="/wangzhongyi1/assets/js/13.b739f245.js"><link rel="prefetch" href="/wangzhongyi1/assets/js/14.5fa710de.js"><link rel="prefetch" href="/wangzhongyi1/assets/js/3.5e436ec2.js"><link rel="prefetch" href="/wangzhongyi1/assets/js/4.afffd8ed.js"><link rel="prefetch" href="/wangzhongyi1/assets/js/5.84a027a4.js"><link rel="prefetch" href="/wangzhongyi1/assets/js/6.4e8ea667.js"><link rel="prefetch" href="/wangzhongyi1/assets/js/7.c8654701.js"><link rel="prefetch" href="/wangzhongyi1/assets/js/8.2d75c429.js"><link rel="prefetch" href="/wangzhongyi1/assets/js/9.c25d02bf.js">
    <link rel="stylesheet" href="/wangzhongyi1/assets/css/0.styles.beeb4ccc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/wangzhongyi1/" class="home-link router-link-active"><!----> <span class="site-name">目录</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/wangzhongyi1/" class="nav-link">
  Home
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/wangzhongyi1/" class="nav-link">
  Home
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/wangzhongyi1/" aria-current="page" class="sidebar-link">大前端团队规划</a></li><li><a href="/wangzhongyi1/devstandard.html" class="sidebar-link">前端开发规范</a></li><li><a href="/wangzhongyi1/checklist.html" class="sidebar-link">前端代码走查CHECKLIST</a></li><li><a href="/wangzhongyi1/gitusage.html" class="sidebar-link">git 日常使用</a></li><li><a href="/wangzhongyi1/gitstandard.html" class="sidebar-link">git 提交规范</a></li><li><a href="/wangzhongyi1/gitmergestandard.html" class="sidebar-link">git 分支合并规范</a></li><li><a href="/wangzhongyi1/jscommonerror.html" class="sidebar-link">前端常见报错类型与解决方案</a></li><li><a href="/wangzhongyi1/htmlstandard.html" class="sidebar-link">HTML 规范</a></li><li><a href="/wangzhongyi1/jsperformance.html" aria-current="page" class="active sidebar-link">javascript 性能优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wangzhongyi1/jsperformance.html#加载和执行" class="sidebar-link">加载和执行</a></li><li class="sidebar-sub-header"><a href="/wangzhongyi1/jsperformance.html#数据存储" class="sidebar-link">数据存储</a></li><li class="sidebar-sub-header"><a href="/wangzhongyi1/jsperformance.html#dom" class="sidebar-link">DOM</a></li><li class="sidebar-sub-header"><a href="/wangzhongyi1/jsperformance.html#算法和流程控制" class="sidebar-link">算法和流程控制</a></li><li class="sidebar-sub-header"><a href="/wangzhongyi1/jsperformance.html#部署和构建" class="sidebar-link">部署和构建</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="javascript-性能优化"><a href="#javascript-性能优化" class="header-anchor">#</a> javascript 性能优化</h1> <h2 id="加载和执行"><a href="#加载和执行" class="header-anchor">#</a> 加载和执行</h2> <ol><li><code>&lt;/body&gt;</code> 闭合标签之前，将所有 <code>&lt;script&gt;</code> 标签放在页面底部，确保在脚本执行前页面已经完成渲染</li> <li>合并脚本。下载单个 100KB 的文件比下载 4 个 25KB 的文件更快，因此页面上的 <code>&lt;script&gt;</code> 标签越少，加载也就越快，响应也越迅速。</li> <li>使用无阻塞下载 javascript 的方法，即在页面加载完成后才加载 js 代码，以下有几种无阻塞下载方法：</li></ol> <ul><li>使用 defer 属性 <code>&lt;script src=&quot;file.js&quot; defer&gt;&lt;/script&gt;</code></li> <li>使用动态创建的 <code>&lt;script&gt;</code> 元素来下载并执行代码</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 核心：监听script元素的 onload 事件</span>
<span class="token keyword">function</span> <span class="token function">loadscript</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  script<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  script<span class="token punctuation">.</span>src <span class="token operator">=</span> url<span class="token punctuation">;</span>
  document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'head'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用：</span>
<span class="token function">loadscript</span><span class="token punctuation">(</span><span class="token string">'file.js'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'file is loaded ~'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>使用 XHR 对象下载 javascript 代码并注入页面中</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token string">'file.js'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span> <span class="token operator">||</span> xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">304</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      script<span class="token punctuation">.</span>text <span class="token operator">=</span> xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">;</span>
      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="数据存储"><a href="#数据存储" class="header-anchor">#</a> 数据存储</h2> <ol><li>访问字面量和局部变量的速度比访问数组元素和对象成员快，因此尽量使用字面量和局部变量，减少数组和对象成员的使用</li> <li>尽可能使用局部变量。如果某个跨作用域的值在函数中被引用一次以上，应该把它存储到局部变量中</li> <li>避免使用 with 语句，它会改变执行环境的作用域链。try-catch 中的 catch 也有同样效果，看实际情况进行运用</li> <li>属性和方法在原型链中的位置越深，访问的速度越慢</li></ol> <p>总结：把常用的对象成员、数组元素、跨域变量 保存在局部变量中，有利于提升性能</p> <h2 id="dom"><a href="#dom" class="header-anchor">#</a> DOM</h2> <ol><li>最小化 DOM 的访问次数，如果需要多次访问某个 DOM 节点，使用局部变量存储它的引用</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 不推荐</span>
<span class="token keyword">function</span> <span class="token function">innerHTMLLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'myDiv'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">+=</span> <span class="token string">'a'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 推荐</span>
<span class="token keyword">function</span> <span class="token function">innerHTMLLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> content <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    content <span class="token operator">+=</span> <span class="token string">'a'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'myDiv'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> content<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>如果需要在迭代中使用 HTML 集合，把它的长度缓存到一个变量中；如果需要多次操作集合，把它拷贝到一个数组中</li></ol> <ul><li>HTML 集合有 document.getElementsByName(), document.getElementsClassName(), document.getElementsByTagName, document.images, document.links, document.forms 等等，返回的是类似数组的列表，但是它以一种“假定实时态”实时存在，即当底层文档对象更新时，它也会自动更新。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 假定实时态 导致的死循环</span>
<span class="token keyword">let</span> divs <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> divs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol><li>减少重绘和重排，批量修改样式时，“离线”操作DOM树，并减少访问布局信息的次数</li></ol> <ul><li>当页面布局和几何属性改变时需要“重排”。下列情况均会发生“重排”
<ul><li>添加或删除可见DOM元素</li> <li>元素位置发生变化</li> <li>元素尺寸改变（包括：外边距、内边距、边框厚度、宽度、高度等属性改变）</li> <li>内容改变，如文本改变或图片被另一个不同尺寸的图片代替</li> <li>页面渲染器初始化</li> <li>浏览器窗口改变</li></ul></li> <li>完成“重排”后，浏览器会重新绘制受影响的部分到屏幕中，过程称为“重绘”</li> <li>减少“重排”和“重绘”
<ul><li>使元素脱离文档流</li> <li>对其应用多次改变</li> <li>把元素带回文档中</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 第一种方式：隐藏元素，应用修改，重新显示</span>
<span class="token keyword">let</span> ul <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ul<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span>
<span class="token function">appendDataToElement</span><span class="token punctuation">(</span>ul<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 向ul中添加附加数据</span>
ul<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'block'</span><span class="token punctuation">;</span>


<span class="token comment">// 第二种方式：使用文档片段在当前 DOM 树之外构建一个子树，再把它拷贝到文档中</span>
<span class="token keyword">let</span> fragment <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createDocumentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">appendDataToElement</span><span class="token punctuation">(</span>fragment<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>fragment<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// 第三种方式：将原始元素拷贝到一个脱离文档的节点中，修改副本，完成后再替换原始元素</span>
<span class="token keyword">let</span> old <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> clone <span class="token operator">=</span> old<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">appendDataToElement</span><span class="token punctuation">(</span>clone<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
old<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">replaceChild</span><span class="token punctuation">(</span>clone<span class="token punctuation">,</span> old<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="4"><li>使用事件委托减少事件处理器的数量</li></ol> <ul><li>Event 对象提供了一个属性叫 target，可以返回事件的目标节点，我们称为事件源对象，也就是说，target就可以表示为当前的事件操作的对象，但不是真正操作dom。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>ul<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  e <span class="token operator">=</span> e <span class="token operator">||</span> window<span class="token punctuation">.</span>event<span class="token punctuation">;</span>
  <span class="token keyword">let</span> target <span class="token operator">=</span> e<span class="token punctuation">.</span>target <span class="token operator">||</span> e<span class="token punctuation">.</span>srcElement<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>target<span class="token punctuation">.</span>nodeName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'li'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>；
</code></pre></div><h2 id="算法和流程控制"><a href="#算法和流程控制" class="header-anchor">#</a> 算法和流程控制</h2> <ul><li>选择时间复杂度低的算法</li> <li>使用 if-else 要确保最可能出现的条件放在首位，条件数量大时，优先使用 switch</li> <li>考虑使用 hash 表存储数据，不仅速度快，而且可读性好</li></ul> <h2 id="部署和构建"><a href="#部署和构建" class="header-anchor">#</a> 部署和构建</h2> <ul><li>合并 javascript 文件以减少 HTTP 请求数</li> <li>使用工具压缩 css 和 js 文件体积</li> <li>启用 gzip 压缩</li> <li>使用 CDN 提供 javascript 文件；CDN 不仅可以提升性能，也会为你管理文件的压缩和缓存</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/wangzhongyi1/htmlstandard.html" class="prev">
        HTML 规范
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/wangzhongyi1/assets/js/app.ef63c046.js" defer></script><script src="/wangzhongyi1/assets/js/2.c8cb3ded.js" defer></script><script src="/wangzhongyi1/assets/js/15.ffaedc48.js" defer></script>
  </body>
</html>
